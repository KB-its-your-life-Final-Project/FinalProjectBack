<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lighthouse.lawdCode.mapper.AddressMapper">
    <!-- 시/도 목록 조회 (코드와 이름 함께) -->
    <select id="selectDistinctSidoWithName" resultType="com.lighthouse.lawdCode.dto.SidoDto">
        SELECT DISTINCT 
            sido_cd as sidoCd,
            CASE 
                WHEN sido_cd = '11' THEN '서울'
                WHEN sido_cd = '26' THEN '부산'
                WHEN sido_cd = '27' THEN '대구'
                WHEN sido_cd = '28' THEN '인천'
                WHEN sido_cd = '29' THEN '광주'
                WHEN sido_cd = '30' THEN '대전'
                WHEN sido_cd = '31' THEN '울산'
                WHEN sido_cd = '36' THEN '세종'
                WHEN sido_cd = '41' THEN '경기'
                WHEN sido_cd = '42' THEN '강원'
                WHEN sido_cd = '43' THEN '충북'
                WHEN sido_cd = '44' THEN '충남'
                WHEN sido_cd = '52' THEN '전북'
                WHEN sido_cd = '46' THEN '전남'
                WHEN sido_cd = '47' THEN '경북'
                WHEN sido_cd = '48' THEN '경남'
                WHEN sido_cd = '50' THEN '제주'
                ELSE '기타'
            END as sidoNm
        FROM ${API_LAWD_CD}
        WHERE is_deleted = 0
        ORDER BY sido_cd
    </select>

    <!-- 시/군/구 목록 조회 (시/도별) - 코드와 이름 함께 -->
    <select id="selectDistinctSggWithNameBySidoCd" parameterType="String" resultType="com.lighthouse.lawdCode.dto.SigugunDto">
        SELECT DISTINCT 
            sgg_cd as sggCd,
            CASE 
                WHEN sido_cd = '11' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                WHEN sido_cd = '26' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                WHEN sido_cd = '27' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                WHEN sido_cd = '28' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                WHEN sido_cd = '29' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                WHEN sido_cd = '30' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                WHEN sido_cd = '31' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                WHEN sido_cd = '36' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                WHEN sido_cd = '41' THEN 
                    CASE 
                        WHEN locatadd_nm LIKE '%구%' THEN 
                            CONCAT(
                                SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1),
                                ' ',
                                SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 3), ' ', -1)
                            )
                        ELSE SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                    END
                WHEN sido_cd = '43' THEN 
                    CASE 
                        WHEN locatadd_nm LIKE '%구%' THEN 
                            CONCAT(
                                SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 1),
                                ' ',
                                SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 2)
                            )
                        ELSE SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 1)
                    END
                WHEN sido_cd = '44' THEN 
                    CASE 
                        WHEN locatadd_nm LIKE '%구%' THEN 
                            CONCAT(
                                SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 1),
                                ' ',
                                SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 2)
                            )
                        ELSE SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 1)
                    END
                WHEN sido_cd = '47' THEN 
                    CASE 
                        WHEN locatadd_nm LIKE '%구%' THEN 
                            CONCAT(
                                SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 1),
                                ' ',
                                SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 2)
                            )
                        ELSE SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 1)
                    END
                WHEN sido_cd = '48' THEN 
                    CASE 
                        WHEN locatadd_nm LIKE '%구%' THEN 
                            CONCAT(
                                SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 1),
                                ' ',
                                SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 2)
                            )
                        ELSE SUBSTRING_INDEX(SUBSTRING(locatadd_nm, 5), ' ', 1)
                    END
                WHEN sido_cd = '42' THEN SUBSTRING_INDEX(locatadd_nm, ' ', -1)
                WHEN sido_cd = '45' THEN SUBSTRING_INDEX(locatadd_nm, ' ', -1)
                WHEN sido_cd = '46' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                WHEN sido_cd = '50' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                WHEN sido_cd = '52' THEN 
                    CASE 
                        WHEN locatadd_nm LIKE '%구%' THEN 
                            CONCAT(
                                SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1),
                                ' ',
                                SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 3), ' ', -1)
                            )
                        ELSE SUBSTRING_INDEX(SUBSTRING_INDEX(locatadd_nm, ' ', 2), ' ', -1)
                    END
                ELSE locatadd_nm
            END as sggNm,
            #{sidoCd} as sidoCd
        FROM ${API_LAWD_CD}
        WHERE sido_cd = #{sidoCd} AND is_deleted = 0
        ORDER BY sgg_cd
    </select>

    <!-- 읍/면/동 목록 조회 (시/도별, 시/군/구별) -->
    <select id="selectDistinctDongBySidoCdAndSggCd" parameterType="String" resultType="com.lighthouse.lawdCode.dto.DongDto">
        SELECT DISTINCT umd_cd as umdCd, locallow_nm as dongNm, sgg_cd as sggCd, sido_cd as sidoCd
        FROM ${API_LAWD_CD}
        WHERE sido_cd = #{sidoCd} AND sgg_cd = #{sggCd} AND is_deleted = 0
        ORDER BY umd_cd
    </select>
    
    <!-- 건물 정보 목록 조회 (지역코드와 읍면동명으로) -->
    <select id="selectBuildingNamesByRegionCodeAndDongName" parameterType="String" resultType="com.lighthouse.lawdCode.dto.BuildingInfoDto">
        SELECT DISTINCT 
            building_name as buildingName,
            latitude,
            longitude,
            jibun_addr as jibunAddr
        FROM estate_api_integration_tbl
        WHERE sgg_cd = #{regionCode} AND umd_nm = #{dongName}
        ORDER BY building_name
    </select>
</mapper>